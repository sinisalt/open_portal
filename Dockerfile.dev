# Development Dockerfile for OpenPortal Frontend
FROM node:20-alpine

# Set working directory
WORKDIR /app

# Install dependencies first (better caching)
COPY package.json package-lock.json ./
RUN npm ci

# Copy application files
COPY . .

# Expose port
EXPOSE 3000

# Start Vite development server with hot reload and proper host binding for Docker
# Only install deps if node_modules is empty, then clear Vite cache and start
CMD ["sh", "-lc", "if [ ! -d node_modules ] || [ -z \"$(ls -A node_modules 2>/dev/null)\" ]; then echo 'Installing dependencies...'; npm ci; fi && rm -rf node_modules/.vite && npm run dev -- --host 0.0.0.0 --no-open"]
